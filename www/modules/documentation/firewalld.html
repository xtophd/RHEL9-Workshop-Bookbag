<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Definitive RHEL9 Workshop (v9.1)</title>
    <link rel="prev" href="systemd.html">
    <link rel="next" href="nftables.html">
    <meta name="generator" content="Antora 3.1.7">
    <link rel="stylesheet" href="../../_/css/site.css">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img
          src="../../_/img/header_logo.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" href="../..">Definitive RHEL9 Workshop (v9.1)</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Books</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">CheatSheets</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">CheatSheet A</a>
            <a class="navbar-item" href="#">CheatSheet B</a>
            <a class="navbar-item" href="#">CheatSheet C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Upcoming Events</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Event A</a>
            <a class="navbar-item" href="#">Event B</a>
            <a class="navbar-item" href="#">Event C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Tutorial A</a>
            <a class="navbar-item" href="#">Tutorial B</a>
            <a class="navbar-item" href="#">Tutorial C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="modules" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html" class=" query-params-link">Default Title</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../overview.html">Workshop Overview</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="webconsole.html">Web Console (cockpit)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="systemd.html">Service Management (systemd)</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="firewalld.html">Firewall Management (firewalld)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="nftables.html">Firewall Rules (nf-tables)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ebpf.html">eBPF Tracing (bcc-tools)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="podman.html">Containers Management (podman)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="buildah.html">Containers Dev (buildah)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="image-builder.html">Image Builder (composer-cli)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="virtualization.html">Virtualization (kvm,libvirt)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="tlog.html">Session Logging (tlog)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="lvm-vdo.html">Data Optimization (lvm,vdo)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="stratis.html">Storage Management (stratis)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="kpatch.html">Kernel Live Patching (kpatch)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="boom-kernel-parms.html">Managing GRUB2 with Boom</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="leapp.html">LEAPP In-Place Upgrades</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Default Title</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Default Title</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="../index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../connection.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Default Title</a></li>
    <li><a href="firewalld.html">Firewall Management (firewalld)</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///Users/jmaltin/Development/RHEL9-Workshop-Showroom/content/modules/ROOT/pages/documentation/firewalld.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<article class="doc">
<div class="sect1">
<h2 id="_firewalld_firewall_service_management"><a class="anchor" href="#_firewalld_firewall_service_management"></a>Firewalld - Firewall Service Management</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_overview"><a class="anchor" href="#_overview"></a>Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <strong>firewalld</strong> daemon provides a dynamically managed network security layer that tightly controls what
connections (ports and services) are able to communicate via the system&#8217;s network interfaces.</p>
</div>
<div class="paragraph">
<p>Features of firewalld include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>support for IPv4 and IPv6 settings</p>
</li>
<li>
<p>support for ethernet bridges</p>
</li>
<li>
<p>support for network “zones” which assigns level of trust to a network / connections / interfaces</p>
</li>
<li>
<p>separation of runtime and permanent configuration options</p>
</li>
<li>
<p>an interface for external services to manage firewall rules directly</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started"><a class="anchor" href="#_getting_started"></a>Getting Started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For these exercises, you will be using the host <code>node1</code> as user <code>root</code>.</p>
</div>
<div class="paragraph">
<p>From host <code>bastion</code>, ssh to <code>node1</code>.</p>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">ssh node1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use <code>sudo</code> to elevate your privileges.</p>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">[[ "$UID" == 0 ]] || sudo -i</code></pre>
</div>
</div>
<div class="paragraph">
<p>Verify that you are on the right host for these exercises.</p>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">workshop-firewalld-checkhost.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>You are now ready to proceed with these exercises.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_core_concepts"><a class="anchor" href="#_core_concepts"></a>Core Concepts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The RHEL 9 firewall consists of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>firewalld : daemon/service</p>
</li>
<li>
<p>firewall-cmd : command line management utility</p>
</li>
<li>
<p>firewall-config : a GUI based management utility</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For this workshop, we are only going to be using firewall-cmd.</p>
</div>
<div class="sect2">
<h3 id="_configuration"><a class="anchor" href="#_configuration"></a>Configuration</h3>
<div class="paragraph">
<p>The configuration files for firewalld are stored in two places:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>/usr/lib/firewalld - distributed system default configs</p>
</li>
<li>
<p>/etc/firewalld - user customizations / override configs</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Configurations stored in <strong>/usr/lib/firewalld</strong> are NOT meant for customization.  They
WILL be overwritten and replaced from time to time as Red Hat releases new packages
or updates for the operating system.</p>
</div>
<div class="paragraph">
<p>User customizations for firewalld belong in <strong>/etc/firewalld</strong>.  These configuration
files take precedence over the system default configs.</p>
</div>
</div>
<div class="sect2">
<h3 id="_services"><a class="anchor" href="#_services"></a>Services</h3>
<div class="paragraph">
<p>Similar to systemd, firewalld implements the concept of a service:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a "service" includes a common name</p>
</li>
<li>
<p>a port or range of ports</p>
</li>
<li>
<p>a protocol</p>
</li>
<li>
<p>a netfilter helper module</p>
</li>
<li>
<p>a destination address (or range) for IPv4 and/or IPv6.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are nearly 50 built-in services shipped with firewalld.  You can also create your own service configs from scratch or customize the default files.  More on that coovered in the exercises below.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s take a quick look at the default configuration for ssh &amp; http to start.</p>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">cat /usr/lib/firewalld/services/ssh.xml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;service&gt;
  &lt;short&gt;SSH&lt;/short&gt;
  &lt;description&gt;Secure Shell (SSH) is a protocol for logging into and executing commands on remote machines. It provides secure encrypted communications. If you plan on accessing your machine remotely via SSH over a firewalled interface, enable this option. You need the openssh-server package installed for this option to be useful.&lt;/description&gt;
  &lt;port protocol="tcp" port="22"/&gt;
&lt;/service&gt;</pre>
</div>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">cat /usr/lib/firewalld/services/http.xml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;service&gt;
  &lt;short&gt;WWW (HTTP)&lt;/short&gt;
  &lt;description&gt;HTTP is the protocol used to serve Web pages. If you plan to make your Web server publicly available, enable this option. This option is not required for viewing pages locally or developing Web pages.&lt;/description&gt;
  &lt;port protocol="tcp" port="80"/&gt;
&lt;/service&gt;</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_determine_state"><a class="anchor" href="#_determine_state"></a>Determine State</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Firewalld maintains two states of the firewall configuration: runtime and permanent.
When you make changes to the configuration it is important to consider what is currently
running and what will persist past the next reboot.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Determine current state of the firewalld service.</p>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">firewall-cmd --state</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">running</pre>
</div>
</div>
<div class="paragraph">
<p>Get a list of currently configured and active "zones".</p>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">firewall-cmd --get-active-zones</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">public
  interfaces: eth0</pre>
</div>
</div>
<div class="paragraph">
<p>You may have one or more zones depending on the host and it&#8217;s configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>public</code> zone on interface <code>eth0</code></p>
</li>
<li>
<p><code>libvirt</code> zone on interface <code>virbr0</code></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In this sample output, the virtual bridge <code>libvirt</code> is created and managed by libvirtd.  It is possible that your system will not have the libvirt zone.  For our purposes, we are only interested in the public zone and the interface <code>eth0</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We had this information from the previous command, but to be more specific let&#8217;s just list the physical interfaces associated with the public zone.</p>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">firewall-cmd --zone=public --list-interfaces</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">eth0</pre>
</div>
</div>
<div class="paragraph">
<p>Get a list of services configured on the public zone.</p>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">firewall-cmd --zone=public --list-services</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">cockpit dhcpv6-client ssh</pre>
</div>
</div>
<div class="paragraph">
<p>We see the web console, the dhcp client and of course the ssh service.</p>
</div>
<div class="paragraph">
<p>Now let&#8217;s get some specific data points on the web console service (cockpit).</p>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">firewall-cmd --info-service=cockpit</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">cockpit
  ports: 9090/tcp
  protocols:
  source-ports:
  modules:
  destination:
  includes:
  helpers:</pre>
</div>
</div>
<div class="paragraph">
<p>Nothing too exciting, but we can note that the web console is configured on port 9090.</p>
</div>
<div class="paragraph">
<p>Finally, let&#8217;s just list everything about the public zone.</p>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">firewall-cmd --zone=public --list-all</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">public (active)
  target: default
  icmp-block-inversion: no
  interfaces: eth0
  sources:
  services: cockpit dhcpv6-client http ssh
  ports:
  protocols:
  forward: yes
  masquerade: no
  forward-ports:
  source-ports:
  icmp-blocks:
  rich rules:</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_managing_default_services"><a class="anchor" href="#_managing_default_services"></a>Managing Default Services</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Default Services are those that are pre-defined by configuration files in either <strong>/etc/firewalld</strong> or <strong>/usr/lib/firewalld</strong>.  This would include any configs delivered by Red Hat as part of the operating system or those added by a system administer.</p>
</div>
<div class="paragraph">
<p>Here we will take a moment to enable the http and https service ports.</p>
</div>
<div class="sect2">
<h3 id="_add_a_service"><a class="anchor" href="#_add_a_service"></a>Add a Service</h3>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">firewall-cmd --add-service={http,https}</code></pre>
</div>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">firewall-cmd --zone=public --list-all</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">public (active)
  target: default
  icmp-block-inversion: no
  interfaces: ens3
  sources:
  services: cockpit dhcpv6-client http https ssh
  ports:
  protocols:
  masquerade: no
  forward-ports:
  source-ports:
  icmp-blocks:
  rich rules:</pre>
</div>
</div>
<div class="paragraph">
<p>Remember how we mentioned above about the two configuration states: runtime and permanent?
Notice below how the permanent state dose NOT include http or https.</p>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">firewall-cmd --zone=public --list-all --permanent</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">public
  target: default
  icmp-block-inversion: no
  interfaces:
  sources:
  services: cockpit dhcpv6-client ssh
  ports:
  protocols:
  masquerade: no
  forward-ports:
  source-ports:
  icmp-blocks:
  rich rules:</pre>
</div>
</div>
<div class="paragraph">
<p>A quick way to make them permanent is to save the current runtime state to permanent.</p>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">firewall-cmd --runtime-to-permanent</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
you could have also run the same configuration command a second time and
passed the <strong>--permanent</strong> flag as follows <code>firewall-cmd --permanent --add-service={http,https}</code>.
It&#8217;s annoying but necessary to run configuration commands twice to manage both states and
maintain consistency.
</td>
</tr>
</table>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">firewall-cmd --zone=public --list-all --permanent</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">public
  target: default
  icmp-block-inversion: no
  interfaces:
  sources:
  services: cockpit dhcpv6-client http https ssh
  ports:
  protocols:
  masquerade: no
  forward-ports:
  source-ports:
  icmp-blocks:
  rich rules:</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_remove_a_default_service"><a class="anchor" href="#_remove_a_default_service"></a>Remove a Default Service</h3>
<div class="paragraph">
<p>Now let us disable a service port not needed for our workshop environment, namely <strong>dhcp6-client</strong>.</p>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">firewall-cmd --remove-service=dhcpv6-client
firewall-cmd --runtime-to-permanent</code></pre>
</div>
</div>
<div class="paragraph">
<p>Take a look at the active services now and you should find dhcp6-client absent.</p>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">firewall-cmd --list-services</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">cockpit http https ssh</pre>
</div>
</div>
<div class="paragraph">
<p>And since we also ran a --runtime-to-permanent, both the
runtime and permanent configs were updated.</p>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">firewall-cmd --list-services --permanent</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">cockpit http https ssh</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_managing_ad_hoc_ports"><a class="anchor" href="#_managing_ad_hoc_ports"></a>Managing Ad-hoc Ports</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_add_a_port"><a class="anchor" href="#_add_a_port"></a>Add a Port</h3>
<div class="paragraph">
<p>Since we have been toying with http, it&#8217;s common for httpd to also be configured on ports 8080 and 8443.  So let&#8217;s simply create and ad-hoc rule to make those ports available.</p>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">firewall-cmd --add-port=8080/tcp --add-port=8443/tcp
firewall-cmd --runtime-to-permanent</code></pre>
</div>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">firewall-cmd --zone=public --list-all</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">public
  target: default
  icmp-block-inversion: no
  interfaces:
  sources:
  services: cockpit http https ssh
  ports: 8080/tcp 8443/tcp
  protocols:
  forward: yes
  masquerade: no
  forward-ports:
  source-ports:
  icmp-blocks:
  rich rules:</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_remove_a_port"><a class="anchor" href="#_remove_a_port"></a>Remove a Port</h3>
<div class="paragraph">
<p>As much fun as that was, ad-hoc was quick and easy but not ideal.  We really desire a formal configuration, so let us undo the ad-hoc rules.</p>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">firewall-cmd --remove-port=8080/tcp --remove-port=8443/tcp
firewall-cmd --runtime-to-permanent</code></pre>
</div>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">firewall-cmd --zone=public --list-all</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">public
  target: default
  icmp-block-inversion: no
  interfaces:
  sources:
  services: cockpit http https ssh
  ports:
  protocols:
  forward: yes
  masquerade: no
  forward-ports:
  source-ports:
  icmp-blocks:
  rich rules:</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customizing_a_default_service"><a class="anchor" href="#_customizing_a_default_service"></a>Customizing a Default Service</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_install_override_configuration"><a class="anchor" href="#_install_override_configuration"></a>Install Override Configuration</h3>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">workshop-firewalld-customconfigs.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>Two configuration files were just created <strong>/etc/firewalld/services</strong></p>
</div>
<div class="paragraph">
<p>They are identical to the system defaults except that our additional ports (8080 and 8443) were added the the definition.</p>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">cat /etc/firewalld/services/http.xml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;service&gt;
  &lt;short&gt;WWW (HTTP)&lt;/short&gt;
  &lt;description&gt;HTTP is the protocol used to serve Web pages. If you plan to make your Web server publicly available, enable this option. This option is not required for viewing pages locally or developing Web pages.&lt;/description&gt;
  &lt;port protocol="tcp" port="80"/&gt;
  &lt;port protocol="tcp" port="8080"/&gt;
&lt;/service&gt;</pre>
</div>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">cat /etc/firewalld/services/https.xml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;service&gt;
  &lt;short&gt;Secure WWW (HTTPS)&lt;/short&gt;
  &lt;description&gt;HTTPS is a modified HTTP used to serve Web pages when security is important. Examples are sites that require logins like stores or web mail. This option is not required for viewing pages locally or developing Web pages. You need the httpd package installed for this option to be useful.&lt;/description&gt;
  &lt;port protocol="tcp" port="443"/&gt;
  &lt;port protocol="tcp" port="8443"/&gt;
&lt;/service&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_activate_service"><a class="anchor" href="#_activate_service"></a>Activate Service</h3>
<div class="paragraph">
<p>Since the httpd service is already active, all we really need to do is reload firewalld.</p>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">firewall-cmd --reload</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_verification"><a class="anchor" href="#_verification"></a>Verification</h3>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">firewall-cmd --info-service=http</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">http
  ports: 80/tcp 8080/tcp
  protocols:
  source-ports:
  modules:
  destination:
  includes:
  helpers:</pre>
</div>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">firewall-cmd --info-service=https</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">https
  ports: 443/tcp 8443/tcp
  protocols:
  source-ports:
  modules:
  destination:
  includes:
  helpers:</pre>
</div>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">firewall-cmd --zone=public --list-all --permanent</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">public
  target: default
  icmp-block-inversion: no
  interfaces:
  sources:
  services: cockpit http https ssh
  ports:
  protocols:
  masquerade: no
  forward-ports:
  source-ports:
  icmp-blocks:
  rich rules:</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_custom_service_from_scratch"><a class="anchor" href="#_custom_service_from_scratch"></a>Custom Service From Scratch</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this exercise you will create a custom service with a unique name.</p>
</div>
<div class="sect2">
<h3 id="_configuration_file"><a class="anchor" href="#_configuration_file"></a>Configuration File</h3>
<div class="paragraph">
<p>First, have a look at the configuration file which has already been prepared for you.  It should be fairly self explanatory.</p>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">cat /usr/local/etc/firewalld-customname.xml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">/usr/local/etc/firewalld-customname.xml</div>
<div class="content">
<pre class="nowrap">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;service&gt;
 &lt;short&gt;workshop&lt;/short&gt;
 &lt;description&gt;Workshop Test Service&lt;/description&gt;
 &lt;port protocol="tcp" port="7890" /&gt;
 &lt;port protocol="udp" port="7890" /&gt;
&lt;/service&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_import"><a class="anchor" href="#_configuration_import"></a>Configuration Import</h3>
<div class="paragraph">
<p>Now it is time to import the config file.</p>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">firewall-cmd --new-service-from-file=/usr/local/etc/firewalld-customname.xml --name=workshop --permanent</code></pre>
</div>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">firewall-cmd --reload</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_activate_service_2"><a class="anchor" href="#_activate_service_2"></a>Activate Service</h3>
<div class="paragraph">
<p>Finally, activate the service and verify.</p>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">firewall-cmd --add-service=workshop</code></pre>
</div>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">firewall-cmd --zone=public --list-all</code></pre>
</div>
</div>
<div class="paragraph">
<p>Just make note of the fact we did not use the '--permanent' option with any of our commands.  If the system reboots, or if firewalld is reloaded then the custom named serviced will be lost.  You can preserve the customizations with a simple <code>firewall-cmd --runtime-to-permanent</code></p>
</div>
<div class="paragraph">
<p>And you are done!</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_panic_mode"><a class="anchor" href="#_panic_mode"></a>Panic Mode</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Panic mode allows you to immediately turn off all network traffic on a host.</p>
</div>
<div class="paragraph">
<p>This is handy to know, but unless you are on the physical system console or remote managed console (ie: ILO, DRAC, etc&#8230;&#8203;) this can be very disruptive.  So we&#8217;ll provide the commands under the strict guidance that you <strong>DON&#8217;T RUN THESE COMMANDS</strong> during this workshop.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p><em>DO NOT RUN THESE COMMANDS</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>firewall-cmd --query-panic

firewall-cmd --panic-on

firewall-cmd --panic-off</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusion"><a class="anchor" href="#_conclusion"></a>Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>That concludes this unit on firewalld.</p>
</div>
<div class="paragraph">
<p>Time to finish this unit and return the shell to it&#8217;s home position.</p>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">workshop-finish-exercise.sh</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_additional_resources"><a class="anchor" href="#_additional_resources"></a>Additional Resources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can find more information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://developers.redhat.com/blog/2018/08/10/firewalld-the-future-is-nftables/">Firewalld: The Future is nftables</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/configuring_firewalls_and_packet_filters/using-and-configuring-firewalld_firewall-packet-filters">Using And Configuring Firewalls</a></p>
</li>
</ul>
</div>
<h2 id="_end_of_unit" class="discrete">End of Unit</h2>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="systemd.html" class="query-params-link">Service Management (systemd)</a></span>
  <span class="next"><a href="nftables.html" class="query-params-link">Firewall Rules (nf-tables)</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../../_/js/vendor/clipboard.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
