<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Definitive RHEL9 Workshop (v9.1)</title>
    <meta name="generator" content="Antora 3.1.7">
    <link rel="stylesheet" href="../../_/css/site.css">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img
          src="../../_/img/header_logo.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" href="../..">Definitive RHEL9 Workshop (v9.1)</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Books</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">CheatSheets</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">CheatSheet A</a>
            <a class="navbar-item" href="#">CheatSheet B</a>
            <a class="navbar-item" href="#">CheatSheet C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Upcoming Events</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Event A</a>
            <a class="navbar-item" href="#">Event B</a>
            <a class="navbar-item" href="#">Event C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Tutorial A</a>
            <a class="navbar-item" href="#">Tutorial B</a>
            <a class="navbar-item" href="#">Tutorial C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="modules" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html" class=" query-params-link">Default Title</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../overview.html">Workshop Overview</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="webconsole.html">Web Console (cockpit)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="systemd.html">Service Management (systemd)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="firewalld.html">Firewall Management (firewalld)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="nftables.html">Firewall Rules (nf-tables)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ebpf.html">eBPF Tracing (bcc-tools)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="podman.html">Containers Management (podman)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="buildah.html">Containers Dev (buildah)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="image-builder.html">Image Builder (composer-cli)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="virtualization.html">Virtualization (kvm,libvirt)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="tlog.html">Session Logging (tlog)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="lvm-vdo.html">Data Optimization (lvm,vdo)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="stratis.html">Storage Management (stratis)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="kpatch.html">Kernel Live Patching (kpatch)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="boom-kernel-parms.html">Managing GRUB2 with Boom</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="leapp.html">LEAPP In-Place Upgrades</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Default Title</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Default Title</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="../index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../connection.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
  <div class="edit-this-page"><a href="file:///Users/jmaltin/Development/RHEL9-Workshop-Showroom/content/modules/ROOT/pages/documentation/appstream-yum.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<article class="doc">
<div class="sect1">
<h2 id="_application_streams"><a class="anchor" href="#_application_streams"></a>Application Streams</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_overview"><a class="anchor" href="#_overview"></a>Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Application Streams are pre-packaged versions of runtime languages, web servers, databases, etc.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>PHP 7.2 is an application stream</p>
</li>
<li>
<p>PHP 7.3 is an application stream</p>
</li>
<li>
<p>PostgreSQL 10 is an application stream</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Application Streams allow multiple versions of things to be available for installation in RHEL.</p>
</div>
<div class="paragraph">
<p>Users can select the applications they want, select the version of the application that they want (the stream), and install and update the Application Stream on their system(s).</p>
</div>
<div class="paragraph">
<p>Application Streams:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>are packaged as Modules, RPMs, and Software Collections (SCL).</p>
</li>
<li>
<p>are the mechanism of delivering and updating software at different speeds</p>
</li>
<li>
<p>allow developers to have bleeding-edge software, and server admins longer stability</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started"><a class="anchor" href="#_getting_started"></a>Getting Started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For these exercises, you will be using the host <code>node1</code> as user <code>root</code>.</p>
</div>
<div class="paragraph">
<p>From host <code>bastion</code>, ssh to <code>node1</code>.</p>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs"><strong>ssh node1</strong></code></pre>
</div>
</div>
<div class="paragraph">
<p>Use <code>sudo</code> to elevate your privileges.</p>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs"><strong>sudo -i</strong></code></pre>
</div>
</div>
<div class="paragraph">
<p>Verify that you are on the right host for these exercises.</p>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs"><strong>workshop-appstream-checkhost.sh</strong></code></pre>
</div>
</div>
<div class="paragraph">
<p>You are now ready to proceed with these exercises.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_choosing_an_appstream_module_on_rhel_8"><a class="anchor" href="#_choosing_an_appstream_module_on_rhel_8"></a>Choosing an appstream module on RHEL 8.</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Determine what modules are available.</p>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs"><strong>yum module list | grep postgresql</strong></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">postgresql           9.6         client, server [d]                       PostgreSQL server and client module
postgresql           10 [d]      client, server [d]                       PostgreSQL server and client module
postgresql           12          client, server                           PostgreSQL server and client module</pre>
</div>
</div>
<div class="paragraph">
<p>This means that I can pick either the postgresql 10 stream (the default), the 9.6 stream, or the 12 stream. This enables me to use whichever postgresql best fits my needs. In the future as new postgresql versions come out, they
can be added as different streams that I can change to as well.
Switching streams is not supported. App Stream allows us to be more in
control with userspace than any previous version of RHEL.</p>
</div>
<div class="paragraph">
<p>On your new RHEL 8 system, if you do:</p>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs"><strong>yum install -y postgresql-server</strong></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">...&lt;SNIP&gt;...
  Installing       : postgresql-server-10.6-1.module+el8+2469+5ecd5aae.x86_64            3/3
  Running scriptlet: postgresql-server-10.6-1.module+el8+2469+5ecd5aae.x86_64            3/3
  Verifying        : libpq-12.1-3.el8.x86_64                                             1/3
  Verifying        : postgresql-10.6-1.module+el8+2469+5ecd5aae.x86_64                   2/3
  Verifying        : postgresql-server-10.6-1.module+el8+2469+5ecd5aae.x86_64            3/3

Installed:
  postgresql-server-10.6-1.module+el8+2469+5ecd5aae.x86_64      libpq-12.1-3.el8.x86_64
  postgresql-10.6-1.module+el8+2469+5ecd5aae.x86_64

Complete!</pre>
</div>
</div>
<div class="paragraph">
<p>But let’s say that our application teams have a dependency on 9.6 but we
want to move to RHEL 8. With the app stream, we can do this. Let&#8217;s do this next exercise on node3.</p>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs"><strong>exit</strong></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then:</p>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs"><strong>ssh node3</strong></code></pre>
</div>
</div>
<div class="paragraph">
<p>INFO: You may need to <code>sudo -i</code> to elevate your privileges.  Just make sure you&#8217;re the <code>root</code> user.</p>
</div>
<div class="paragraph">
<p>On node3, let’s now run:</p>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs"><strong>yum module install -y postgresql:9.6/server</strong></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above command tells yum to install the server profile for postgresql
in the 9.6 version.</p>
</div>
<div class="paragraph">
<p>Once we’ve installed that, we will see:</p>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs"><strong>yum module list | grep postgresql</strong></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">postgresql           9.6 [e]      client, server [d] [i]                   PostgreSQL server and client module
postgresql           10 [d]       client, server [d]                       PostgreSQL server and client module
postgresql           12           client, server                           PostgreSQL server and client module</pre>
</div>
</div>
<div class="paragraph">
<p>The [e] by 9.6 means enabled. The [i] by server means installed.
Anywhere that we see a [d] it represents the default on the operating
system.</p>
</div>
<div class="paragraph">
<p>The server profile installs both the server and the client. If we just
wanted the client, we could remove the server profile:</p>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs"># <strong>yum module remove -y postgresql:9.6/server</strong></code></pre>
</div>
</div>
<div class="paragraph">
<p>and install only the client:</p>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs"><strong>yum module install -y postgresql:9.6/client</strong></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let&#8217;s inspect what yum tells us about the postgresql modules:</p>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs"><strong>yum module list | grep postgresql</strong></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">postgresql           9.6 [e]      client [i], server [d]                   PostgreSQL server and client module
postgresql           10 [d]       client, server [d]                       PostgreSQL server and client module
postgresql           12           client, server                           PostgreSQL server and client module</pre>
</div>
</div>
<div class="paragraph">
<p>This shows us that the 9.6 stream is enabled and the client is installed, but the server is not. If the server were installed, it too would have a [i] in the output.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_disabling_application_streams"><a class="anchor" href="#_disabling_application_streams"></a>Disabling application streams</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Another interesting feature of application streams is the ability to
easily prevent packages from being installed. On node3.example.com, we
just installed postgresql. We don’t want to have another database on the
same machine and we see app stream profiles for mysql and mariadb. Let’s
disable these:</p>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs"><strong>yum module disable mariadb mysql -y</strong></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now when we do yum module list, we will see:</p>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs"><strong>yum module list | grep -e mariadb -e mysql</strong></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">mariadb                  10.3 [d][x]     client, server [d], galera                   MariaDB Module
mysql                    8.0 [d][x]      client, server [d]                           MySQL Module</pre>
</div>
</div>
<div class="paragraph">
<p>The [x] stands for disabled. When we run:</p>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs"><strong>yum install mariadb -y</strong></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">No match for argument: mariadb
Error: Unable to find a match</pre>
</div>
</div>
<div class="paragraph">
<p>To re-enable these app streams and allow the packages to be installed,
the command is:</p>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs"><strong>yum module enable mariadb mysql -y</strong></code></pre>
</div>
</div>
<div class="paragraph">
<p>You may now switch back to the bastion:</p>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs"><strong>exit</strong></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_summary"><a class="anchor" href="#_summary"></a>Summary</h2>
<div class="sectionbody">
<h3 id="_application_streams_and_modules_are_they_the_same_thing" class="discrete">Application Streams and Modules - Are they the same thing?</h3>
<div class="ulist">
<ul>
<li>
<p>Application Streams are installable components with multiple versions available
+ Application Streams have a specified life, i.e. 5 years</p>
</li>
<li>
<p>Modules are the packaging used to build Application Streams
+ Modules have streams too, used to provide Application Streams</p>
</li>
<li>
<p>Module packaging will be used for lots of things in RHEL, not all modules will be supported Application Streams
+Some modules are just single stream and some are just dependencies</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bonus_app_stream_automation_with_ansible"><a class="anchor" href="#_bonus_app_stream_automation_with_ansible"></a>(BONUS) App Stream Automation with Ansible</h2>
<div class="sectionbody">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Depending on the workshop environment deployed, your bastion host may not have access to ansible.  In some cases, if your host does NOT have ansible installed, you may be able to install an unsupported version from the EPEL repo.  Only install the EPEL version if instructed to do so: <code>workshop-ansible-from-epel.sh</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>App Stream operations can be performed in ansible with the 'dnf' module.  Here is a sample of a dnf task:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">- name: install the postgresql 9.6 stream with the client profile.
  dnf:
    name: '@postgresql:9.6/client'
    state: present</code></pre>
</div>
</div>
<div class="paragraph">
<p>A complete sample of a dnf based playbook for this cluster is provided on the bastion host.</p>
</div>
<div class="paragraph">
<p>As user <code>root</code> on the host <code>bastion</code>, run the following:</p>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs"><strong>cd /usr/local/src</strong>

<strong>ansible-playbook -i appstream-inventory.yml appstream-playbook.yml</strong></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then to verify, you can use an ansible adhoc command to check your work.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># <strong>cd /usr/local/src</strong>

# <strong>ansible rhel8 -i appstream-inventory.yml -o -a "rpm -q postgresql-server"</strong>

node1 | CHANGED | rc=0 | (stdout) postgresql-server-10.6-1.module+el8+2469+5ecd5aae.x86_64
node2 | FAILED! =&gt; {"ansible_facts": {"discovered_interpreter_python": "/usr/libexec/platform-python"},"changed": true,"cmd": ["rpm","-q","postgresql-server"],"delta": "0:00:00.007318","end": "2020-05-01 17:28:38.719189","msg": "non-zero return code","rc": 1,"start": "2020-05-01 17:28:38.711871","stderr": "","stderr_lines": [],"stdout": "package postgresql-server is not installed","stdout_lines": ["package postgresql-server is not installed"],"warnings": ["Consider using the yum, dnf or zypper module rather than running 'rpm'.  If you need to use command because yum, dnf or zypper is insufficient you can add 'warn: false' to this command task or set 'command_warnings=False' in ansible.cfg to get rid of this message."]}
node3 | CHANGED | rc=0 | (stdout) postgresql-server-9.6.10-1.module+el8+2470+d1bafa0e.x86_64</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You will get an error from node2, since postgresql-server was not installed there
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You should have:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>postgresql-server 10.6 on node1</p>
</li>
<li>
<p>no postgresql-server on node2 (failed)</p>
</li>
<li>
<p>postgresql-server 9.6 on node3</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_additional_resources"><a class="anchor" href="#_additional_resources"></a>Additional Resources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Red Hat Documentation</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/installing_managing_and_removing_user-space_components/index">RHEL 8 Documentation: Installing, Managing, and Removing User Space Components</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/installing_managing_and_removing_user-space_components/using-appstream_using-appstream">RHEL 8 Documentation: Using Appstream</a></p>
</li>
</ul>
</div>
<h2 id="_end_of_unit" class="discrete">End of Unit</h2>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../../_/js/vendor/clipboard.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
